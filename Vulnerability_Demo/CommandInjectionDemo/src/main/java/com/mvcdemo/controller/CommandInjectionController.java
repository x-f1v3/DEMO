package com.mvcdemo.controller;


import org.apache.commons.io.FileUtils;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.multipart.MultipartHttpServletRequest;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import java.io.BufferedReader;
import java.io.File;

import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.net.URLEncoder;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Set;


@Controller
@RequestMapping("/")
public class CommandInjectionController {

    @RequestMapping("/CommandInjection")
    public void CommandInjection(HttpServletRequest request,HttpServletResponse response) throws IOException {
        String command = request.getParameter("command");
        PrintWriter out = response.getWriter();
        StringBuffer buffer = new StringBuffer();


        if (command != null && command.equals("")) {

            try {
                out.println("Command: ping" + command);
                Runtime rt = Runtime.getRuntime();
                Process proc = rt.exec("cmd.exe /C ping " + command);
                int res = proc.waitFor();
                if (res != 0) {
                    out.println("process error: " + res);
                }
                InputStream in = (res == 0) ? proc.getInputStream() : proc.getErrorStream();
                BufferedReader reader = new BufferedReader(new InputStreamReader(in));
                String line;
                while ((line = reader.readLine()) != null) {

                    buffer.append(line + "\n");
                }

            } catch (Exception e) {
                e.printStackTrace();
            }

            out.println(buffer.toString());

        }



    }



}
